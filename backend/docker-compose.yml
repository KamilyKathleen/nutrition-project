# ğŸ³ Docker Compose para MongoDB
# Por que usar Docker Compose?
# - Orquestra mÃºltiplos containers
# - ConfiguraÃ§Ã£o declarativa
# - FÃ¡cil de versionar no Git
# - ReproduzÃ­vel em qualquer ambiente

version: '3.8'

services:
  # ğŸƒ MongoDB Database
  mongodb:
    image: mongo:7.0              # VersÃ£o estÃ¡vel mais recente
    container_name: nutrition-mongo
    restart: always               # Reinicia se crashar
    
    # ğŸ”’ ConfiguraÃ§Ãµes de SeguranÃ§a
    environment:
      MONGO_INITDB_ROOT_USERNAME: nutrition_admin
      MONGO_INITDB_ROOT_PASSWORD: nutrition_2024_secure
      MONGO_INITDB_DATABASE: nutrition_db
    
    # ğŸ”Œ Mapeamento de Portas
    ports:
      - "27017:27017"             # localhost:27017 -> container:27017
    
    # ğŸ’¾ PersistÃªncia de Dados
    volumes:
      - mongodb_data:/data/db     # Volume nomeado para persistir dados
      - ./init-mongo.js:/docker-entrypoint-initdb.d/init-mongo.js:ro
    
    # ğŸŒ Rede interna
    networks:
      - nutrition_network

  # ğŸ–¥ï¸ MongoDB Express (Interface Web - Opcional)
  mongo-express:
    image: mongo-express:1.0.0-alpha
    container_name: nutrition-mongo-express
    restart: always
    
    # ğŸ”— DependÃªncias
    depends_on:
      - mongodb
    
    # ğŸ”’ ConfiguraÃ§Ãµes de Acesso
    environment:
      ME_CONFIG_MONGODB_ADMINUSERNAME: nutrition_admin
      ME_CONFIG_MONGODB_ADMINPASSWORD: nutrition_2024_secure
      ME_CONFIG_MONGODB_URL: mongodb://nutrition_admin:nutrition_2024_secure@mongodb:27017/
      ME_CONFIG_BASICAUTH_USERNAME: admin
      ME_CONFIG_BASICAUTH_PASSWORD: admin123
    
    # ğŸ”Œ Interface Web
    ports:
      - "8081:8081"               # http://localhost:8081
    
    networks:
      - nutrition_network

# ğŸ’¾ Volumes Nomeados
volumes:
  mongodb_data:                   # Persiste dados mesmo se container for removido

# ğŸŒ Redes
networks:
  nutrition_network:              # Rede interna para comunicaÃ§Ã£o entre containers
    driver: bridge