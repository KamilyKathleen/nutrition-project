# ğŸ³ Docker Compose para MongoDB
# Por que usar Docker Compose?
# - Orquestra mÃºltiplos containers
# - ConfiguraÃ§Ã£o declarativa
# - FÃ¡cil de versionar no Git
# - ReproduzÃ­vel em qualquer ambiente
# 
# âš ï¸ IMPORTANTE: Copie .env.docker.example para .env.docker e altere as senhas!

version: '3.8'

services:
  # ğŸƒ MongoDB Database
  mongodb:
    image: mongo:7.0              # VersÃ£o estÃ¡vel mais recente
    container_name: nutrition-mongo
    restart: always               # Reinicia se crashar
    env_file:
      - .env.docker               # Carrega variÃ¡veis do arquivo .env.docker
    
    # ğŸ”’ ConfiguraÃ§Ãµes de SeguranÃ§a
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD}
      MONGO_INITDB_DATABASE: ${MONGO_INITDB_DATABASE}
    
    # ğŸ”Œ Mapeamento de Portas
    ports:
      - "27017:27017"             # localhost:27017 -> container:27017
    
    # ğŸ’¾ PersistÃªncia de Dados
    volumes:
      - mongodb_data:/data/db     # Volume nomeado para persistir dados
      - ./init-mongo.js:/docker-entrypoint-initdb.d/init-mongo.js:ro
    
    # ğŸŒ Rede interna
    networks:
      - nutrition_network

  # ğŸ–¥ï¸ MongoDB Express (Interface Web - Opcional)
  mongo-express:
    image: mongo-express:1.0.0-alpha
    container_name: nutrition-mongo-express
    restart: always
    env_file:
      - .env.docker               # Carrega variÃ¡veis do arquivo .env.docker
    
    # ğŸ”— DependÃªncias
    depends_on:
      - mongodb
    
    # ğŸ”’ ConfiguraÃ§Ãµes de Acesso
    environment:
      ME_CONFIG_MONGODB_ADMINUSERNAME: ${MONGO_INITDB_ROOT_USERNAME}
      ME_CONFIG_MONGODB_ADMINPASSWORD: ${MONGO_INITDB_ROOT_PASSWORD}
      ME_CONFIG_MONGODB_URL: mongodb://${MONGO_INITDB_ROOT_USERNAME}:${MONGO_INITDB_ROOT_PASSWORD}@mongodb:27017/
      ME_CONFIG_BASICAUTH_USERNAME: ${ME_CONFIG_BASICAUTH_USERNAME}
      ME_CONFIG_BASICAUTH_PASSWORD: ${ME_CONFIG_BASICAUTH_PASSWORD}
    
    # ğŸ”Œ Interface Web
    ports:
      - "8081:8081"               # http://localhost:8081
    
    networks:
      - nutrition_network

# ğŸ’¾ Volumes Nomeados
volumes:
  mongodb_data:                   # Persiste dados mesmo se container for removido

# ğŸŒ Redes
networks:
  nutrition_network:              # Rede interna para comunicaÃ§Ã£o entre containers
    driver: bridge